{% extends "base.html" %}

{% block title %}Addon Management - LXCloud{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col">
            <h1 class="h3 mb-0">
                <i class="fas fa-puzzle-piece text-primary"></i> 
                Addon Management
            </h1>
            <p class="text-muted">Manage controller type addons and extensions</p>
        </div>
        <div class="col-auto">
            <a href="{{ url_for('admin.new_addon') }}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add New Addon
            </a>
        </div>
    </div>

    <!-- Addons List -->
    <div class="row">
        <div class="col">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list"></i> 
                        Installed Addons
                    </h5>
                </div>
                <div class="card-body">
                    {% if addons %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Controller Type</th>
                                        <th>Description</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for addon in addons %}
                                    <tr>
                                        <td>
                                            <strong>{{ addon.name }}</strong>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">
                                                {{ addon.controller_type.title() }}
                                            </span>
                                        </td>
                                        <td>{{ addon.description or '-' }}</td>
                                        <td>
                                            {% if addon.is_active %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check-circle"></i> Active
                                                </span>
                                            {% else %}
                                                <span class="badge bg-secondary">
                                                    <i class="fas fa-pause-circle"></i> Inactive
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if addon.created_at %}
                                                {{ addon.created_at.strftime('%Y-%m-%d') }}
                                            {% else %}
                                                -
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="btn-group" role="group">
                                                <form method="POST" action="{{ url_for('admin.toggle_addon', addon_id=addon.id) }}" class="d-inline">
                                                    <button type="submit" class="btn btn-sm btn-outline-{{ 'warning' if addon.is_active else 'success' }}" 
                                                            title="{{ 'Deactivate' if addon.is_active else 'Activate' }} Addon">
                                                        <i class="fas fa-{{ 'pause' if addon.is_active else 'play' }}"></i>
                                                    </button>
                                                </form>
                                                
                                                <button type="button" class="btn btn-sm btn-outline-info" 
                                                        data-bs-toggle="modal" 
                                                        data-bs-target="#configModal{{ addon.id }}"
                                                        title="Configure Addon">
                                                    <i class="fas fa-cog"></i>
                                                </button>
                                                
                                                <form method="POST" action="{{ url_for('admin.delete_addon', addon_id=addon.id) }}" 
                                                      class="d-inline" 
                                                      onsubmit="return confirm('Are you sure you want to delete this addon?')">
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" 
                                                            title="Delete Addon">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>

                                            <!-- Configuration Modal -->
                                            <div class="modal fade" id="configModal{{ addon.id }}" tabindex="-1">
                                                <div class="modal-dialog modal-lg">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Configure {{ addon.name }}</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <h6>Basic Information</h6>
                                                                    <table class="table table-sm table-borderless">
                                                                        <tr>
                                                                            <td><strong>Name:</strong></td>
                                                                            <td>{{ addon.name }}</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td><strong>Type:</strong></td>
                                                                            <td>{{ addon.controller_type.title() }}</td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td><strong>Status:</strong></td>
                                                                            <td>
                                                                                {% if addon.is_active %}
                                                                                    <span class="badge bg-success">Active</span>
                                                                                {% else %}
                                                                                    <span class="badge bg-secondary">Inactive</span>
                                                                                {% endif %}
                                                                            </td>
                                                                        </tr>
                                                                    </table>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <h6>Configuration</h6>
                                                                    <pre class="bg-light p-2 rounded font-monospace small">{{ addon.get_config() | tojson(indent=2) }}</pre>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-puzzle-piece fa-4x text-muted mb-3"></i>
                            <h5 class="text-muted">No Addons Installed</h5>
                            <p class="text-muted">No addons are currently installed in the system.</p>
                            <a href="{{ url_for('admin.new_addon') }}" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Your First Addon
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.table td {
    vertical-align: middle;
}

.btn-group .btn {
    border-radius: 0;
}

.btn-group .btn:first-child {
    border-top-left-radius: 0.375rem;
    border-bottom-left-radius: 0.375rem;
}

.btn-group .btn:last-child {
    border-top-right-radius: 0.375rem;
    border-bottom-right-radius: 0.375rem;
}

.font-monospace {
    font-family: 'Courier New', Courier, monospace;
}

pre {
    max-height: 300px;
    overflow-y: auto;
}
</style>
{% endblock %}