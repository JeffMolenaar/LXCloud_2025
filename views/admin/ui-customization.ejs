<%- include('../partials/header', { user: user, title: title }) %>

<div class="container-fluid">
    <div class="row">
        <%- include('../partials/sidebar', { user: user }) %>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">
                    <i class="fas fa-palette me-2"></i>
                    UI Customization
                </h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <a href="/admin" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-arrow-left me-1"></i>
                            Back to Admin
                        </a>
                        <button class="btn btn-sm btn-success" onclick="saveCustomization()">
                            <i class="fas fa-save me-1"></i>
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Customization Options -->
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-paint-brush me-2"></i>
                                Interface Customization
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Theme Selection -->
                            <div class="mb-4">
                                <h6>Theme Selection</h6>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="card border-primary theme-option" data-theme="default">
                                            <div class="card-body text-center">
                                                <div class="theme-preview bg-light p-3 mb-2">
                                                    <div class="bg-primary text-white p-1 mb-1">Header</div>
                                                    <div class="bg-secondary text-white p-1">Content</div>
                                                </div>
                                                <strong>Default Theme</strong>
                                                <div class="form-check mt-2">
                                                    <input class="form-check-input" type="radio" name="theme" id="themeDefault" value="default" checked>
                                                    <label class="form-check-label" for="themeDefault">
                                                        Select
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-dark theme-option" data-theme="dark">
                                            <div class="card-body text-center">
                                                <div class="theme-preview bg-dark p-3 mb-2">
                                                    <div class="bg-info text-white p-1 mb-1">Header</div>
                                                    <div class="bg-secondary text-white p-1">Content</div>
                                                </div>
                                                <strong>Dark Theme</strong>
                                                <div class="form-check mt-2">
                                                    <input class="form-check-input" type="radio" name="theme" id="themeDark" value="dark">
                                                    <label class="form-check-label" for="themeDark">
                                                        Select
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-success theme-option" data-theme="nature">
                                            <div class="card-body text-center">
                                                <div class="theme-preview bg-light p-3 mb-2">
                                                    <div class="bg-success text-white p-1 mb-1">Header</div>
                                                    <div class="bg-light text-dark p-1">Content</div>
                                                </div>
                                                <strong>Nature Theme</strong>
                                                <div class="form-check mt-2">
                                                    <input class="form-check-input" type="radio" name="theme" id="themeNature" value="nature">
                                                    <label class="form-check-label" for="themeNature">
                                                        Select
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Color Customization -->
                            <div class="mb-4">
                                <h6>Color Customization</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="primaryColor" class="form-label">Primary Color</label>
                                            <input type="color" class="form-control form-control-color" id="primaryColor" value="#0d6efd">
                                        </div>
                                        <div class="mb-3">
                                            <label for="secondaryColor" class="form-label">Secondary Color</label>
                                            <input type="color" class="form-control form-control-color" id="secondaryColor" value="#6c757d">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="successColor" class="form-label">Success Color</label>
                                            <input type="color" class="form-control form-control-color" id="successColor" value="#198754">
                                        </div>
                                        <div class="mb-3">
                                            <label for="dangerColor" class="form-label">Danger Color</label>
                                            <input type="color" class="form-control form-control-color" id="dangerColor" value="#dc3545">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Logo Upload -->
                            <div class="mb-4">
                                <h6>Logo Customization</h6>
                                <div class="mb-3">
                                    <label for="logoUpload" class="form-label">Upload Custom Logo</label>
                                    <input type="file" class="form-control" id="logoUpload" accept="image/*">
                                    <div class="form-text">Recommended size: 200x50px, PNG or SVG format</div>
                                </div>
                                <div class="mb-3">
                                    <div class="current-logo">
                                        <img src="/images/logo.png" alt="Current Logo" class="img-thumbnail" style="max-height: 50px;" onerror="this.style.display='none'">
                                        <span class="text-muted ms-2">Current logo (or default if none)</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Custom CSS -->
                            <div class="mb-4">
                                <h6>Custom CSS</h6>
                                <div class="mb-3">
                                    <label for="customCSS" class="form-label">Additional CSS Rules</label>
                                    <textarea class="form-control" id="customCSS" rows="8" placeholder="/* Add your custom CSS here */&#10;.custom-header {&#10;    background-color: #custom;&#10;}"></textarea>
                                    <div class="form-text">
                                        Add custom CSS to further customize the interface. 
                                        <strong>Warning:</strong> Invalid CSS may break the interface.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Preview -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-eye me-2"></i>
                                Live Preview
                            </h5>
                        </div>
                        <div class="card-body">
                            <div id="livePreview" class="border rounded p-3">
                                <!-- Navigation Preview -->
                                <div class="bg-primary text-white p-2 mb-2">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span><strong>LXCloud</strong></span>
                                        <span>Admin ▼</span>
                                    </div>
                                </div>
                                
                                <!-- Content Preview -->
                                <div class="bg-light p-2 mb-2">
                                    <h6>Dashboard</h6>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="bg-success text-white p-1 text-center small">
                                                Online: 5
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="bg-warning text-dark p-1 text-center small">
                                                Offline: 2
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Button Preview -->
                                <div class="d-flex gap-1">
                                    <button class="btn btn-primary btn-sm">Primary</button>
                                    <button class="btn btn-secondary btn-sm">Secondary</button>
                                    <button class="btn btn-success btn-sm">Success</button>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <button class="btn btn-outline-primary btn-sm w-100" onclick="updatePreview()">
                                    <i class="fas fa-sync me-1"></i>
                                    Update Preview
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-magic me-2"></i>
                                Quick Actions
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-info btn-sm" onclick="resetToDefault()">
                                    <i class="fas fa-undo me-1"></i>
                                    Reset to Default
                                </button>
                                <button class="btn btn-outline-warning btn-sm" onclick="exportTheme()">
                                    <i class="fas fa-download me-1"></i>
                                    Export Theme
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="importTheme()">
                                    <i class="fas fa-upload me-1"></i>
                                    Import Theme
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
function updatePreview() {
    const primaryColor = document.getElementById('primaryColor').value;
    const secondaryColor = document.getElementById('secondaryColor').value;
    const successColor = document.getElementById('successColor').value;
    const dangerColor = document.getElementById('dangerColor').value;
    
    const preview = document.getElementById('livePreview');
    const primaryElement = preview.querySelector('.bg-primary');
    const successElement = preview.querySelector('.bg-success');
    const primaryButton = preview.querySelector('.btn-primary');
    const secondaryButton = preview.querySelector('.btn-secondary');
    const successButton = preview.querySelector('.btn-success');
    
    if (primaryElement) primaryElement.style.backgroundColor = primaryColor;
    if (successElement) successElement.style.backgroundColor = successColor;
    if (primaryButton) primaryButton.style.backgroundColor = primaryColor;
    if (secondaryButton) secondaryButton.style.backgroundColor = secondaryColor;
    if (successButton) successButton.style.backgroundColor = successColor;
}

function saveCustomization() {
    const formData = {
        theme: document.querySelector('input[name="theme"]:checked').value,
        primaryColor: document.getElementById('primaryColor').value,
        secondaryColor: document.getElementById('secondaryColor').value,
        successColor: document.getElementById('successColor').value,
        dangerColor: document.getElementById('dangerColor').value,
        customCSS: document.getElementById('customCSS').value
    };
    
    // In a real implementation, this would save to the database
    alert('UI customization saved successfully! Changes will be applied on next page load.');
}

function resetToDefault() {
    if (confirm('Are you sure you want to reset all customizations to default? This action cannot be undone.')) {
        document.getElementById('themeDefault').checked = true;
        document.getElementById('primaryColor').value = '#0d6efd';
        document.getElementById('secondaryColor').value = '#6c757d';
        document.getElementById('successColor').value = '#198754';
        document.getElementById('dangerColor').value = '#dc3545';
        document.getElementById('customCSS').value = '';
        updatePreview();
    }
}

function exportTheme() {
    const themeData = {
        theme: document.querySelector('input[name="theme"]:checked').value,
        colors: {
            primary: document.getElementById('primaryColor').value,
            secondary: document.getElementById('secondaryColor').value,
            success: document.getElementById('successColor').value,
            danger: document.getElementById('dangerColor').value
        },
        customCSS: document.getElementById('customCSS').value
    };
    
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(themeData, null, 2));
    const downloadAnchor = document.createElement('a');
    downloadAnchor.setAttribute("href", dataStr);
    downloadAnchor.setAttribute("download", "lxcloud-theme.json");
    document.body.appendChild(downloadAnchor);
    downloadAnchor.click();
    downloadAnchor.remove();
}

function importTheme() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const themeData = JSON.parse(e.target.result);
                    
                    // Apply imported theme
                    if (themeData.theme) {
                        const themeRadio = document.getElementById('theme' + themeData.theme.charAt(0).toUpperCase() + themeData.theme.slice(1));
                        if (themeRadio) themeRadio.checked = true;
                    }
                    
                    if (themeData.colors) {
                        if (themeData.colors.primary) document.getElementById('primaryColor').value = themeData.colors.primary;
                        if (themeData.colors.secondary) document.getElementById('secondaryColor').value = themeData.colors.secondary;
                        if (themeData.colors.success) document.getElementById('successColor').value = themeData.colors.success;
                        if (themeData.colors.danger) document.getElementById('dangerColor').value = themeData.colors.danger;
                    }
                    
                    if (themeData.customCSS) {
                        document.getElementById('customCSS').value = themeData.customCSS;
                    }
                    
                    updatePreview();
                    alert('Theme imported successfully!');
                } catch (error) {
                    alert('Error importing theme: Invalid file format');
                }
            };
            reader.readAsText(file);
        }
    };
    input.click();
}

// Initialize preview
document.addEventListener('DOMContentLoaded', function() {
    updatePreview();
    
    // Add event listeners for real-time preview updates
    document.getElementById('primaryColor').addEventListener('input', updatePreview);
    document.getElementById('secondaryColor').addEventListener('input', updatePreview);
    document.getElementById('successColor').addEventListener('input', updatePreview);
    document.getElementById('dangerColor').addEventListener('input', updatePreview);
});
</script>

<%- include('../partials/footer') %>