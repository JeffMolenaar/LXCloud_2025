<%- include('../partials/header', { user: user, title: title }) %>

<div class="container-fluid">
    <div class="row">
        <%- include('../partials/sidebar', { user: user }) %>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">
                    <i class="fas fa-puzzle-piece me-2"></i>
                    Addon Management
                </h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <a href="/admin" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-arrow-left me-1"></i>
                            Back to Admin
                        </a>
                        <button class="btn btn-sm btn-primary" onclick="showInstallAddonModal()">
                            <i class="fas fa-plus me-1"></i>
                            Install Addon
                        </button>
                    </div>
                </div>
            </div>

            <!-- Available Addons -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-store me-2"></i>
                                Available Addons
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Example Addon Cards -->
                                <div class="col-lg-4 col-md-6 mb-3">
                                    <div class="card h-100 border-info">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h6 class="card-title">
                                                    <i class="fas fa-chart-line text-info me-2"></i>
                                                    Advanced Analytics
                                                </h6>
                                                <span class="badge bg-info">Available</span>
                                            </div>
                                            <p class="card-text text-muted small">
                                                Enhanced analytics dashboard with machine learning insights for controller data.
                                            </p>
                                            <div class="mb-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-user me-1"></i>LXCloud Team
                                                    <i class="fas fa-star ms-2 me-1"></i>4.8
                                                    <i class="fas fa-download ms-2 me-1"></i>1.2k
                                                </small>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-success"><strong>Free</strong></small>
                                                <button class="btn btn-sm btn-outline-info" onclick="installAddon('advanced-analytics')">
                                                    <i class="fas fa-download me-1"></i>Install
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-6 mb-3">
                                    <div class="card h-100 border-success">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h6 class="card-title">
                                                    <i class="fas fa-bell text-success me-2"></i>
                                                    Smart Notifications
                                                </h6>
                                                <span class="badge bg-success">Available</span>
                                            </div>
                                            <p class="card-text text-muted small">
                                                Intelligent alerting system with email, SMS, and push notifications for critical events.
                                            </p>
                                            <div class="mb-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-user me-1"></i>LXCloud Team
                                                    <i class="fas fa-star ms-2 me-1"></i>4.9
                                                    <i class="fas fa-download ms-2 me-1"></i>2.1k
                                                </small>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-warning"><strong>$9.99/mo</strong></small>
                                                <button class="btn btn-sm btn-outline-success" onclick="installAddon('smart-notifications')">
                                                    <i class="fas fa-download me-1"></i>Install
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-4 col-md-6 mb-3">
                                    <div class="card h-100 border-warning">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h6 class="card-title">
                                                    <i class="fas fa-mobile-alt text-warning me-2"></i>
                                                    Mobile App Integration
                                                </h6>
                                                <span class="badge bg-warning">Available</span>
                                            </div>
                                            <p class="card-text text-muted small">
                                                Connect your LXCloud dashboard with native iOS and Android mobile applications.
                                            </p>
                                            <div class="mb-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-user me-1"></i>LXCloud Team
                                                    <i class="fas fa-star ms-2 me-1"></i>4.7
                                                    <i class="fas fa-download ms-2 me-1"></i>850
                                                </small>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-success"><strong>Free</strong></small>
                                                <button class="btn btn-sm btn-outline-warning" onclick="installAddon('mobile-integration')">
                                                    <i class="fas fa-download me-1"></i>Install
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Installed Addons -->
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-check-circle me-2"></i>
                                Installed Addons
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                No addons are currently installed. Install addons from the available selection above to extend LXCloud functionality.
                            </div>
                            
                            <!-- Example of installed addon (hidden by default) -->
                            <div class="d-none" id="installedAddonsExample">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Version</th>
                                                <th>Status</th>
                                                <th>Last Updated</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-chart-line text-info me-2"></i>
                                                        <div>
                                                            <strong>Advanced Analytics</strong>
                                                            <br>
                                                            <small class="text-muted">Enhanced analytics dashboard</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>v1.2.0</td>
                                                <td>
                                                    <span class="badge bg-success">
                                                        <i class="fas fa-circle me-1"></i>Active
                                                    </span>
                                                </td>
                                                <td>
                                                    <small class="text-muted">2 days ago</small>
                                                </td>
                                                <td>
                                                    <div class="btn-group" role="group">
                                                        <button class="btn btn-sm btn-outline-warning" title="Configure">
                                                            <i class="fas fa-cog"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-secondary" title="Disable">
                                                            <i class="fas fa-pause"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-danger" title="Uninstall">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Install Addon Modal -->
<div class="modal fade" id="installAddonModal" tabindex="-1" aria-labelledby="installAddonModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="installAddonModalLabel">
                    <i class="fas fa-puzzle-piece me-2"></i>
                    Install Addon
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="addonSource" class="form-label">Installation Method</label>
                    <select class="form-control" id="addonSource">
                        <option value="marketplace">From Marketplace</option>
                        <option value="file">Upload File</option>
                        <option value="url">From URL</option>
                    </select>
                </div>
                
                <div id="marketplaceOption">
                    <div class="mb-3">
                        <label for="addonSearch" class="form-label">Search Addons</label>
                        <input type="text" class="form-control" id="addonSearch" placeholder="Search for addons...">
                    </div>
                </div>
                
                <div id="fileOption" class="d-none">
                    <div class="mb-3">
                        <label for="addonFile" class="form-label">Addon Package</label>
                        <input type="file" class="form-control" id="addonFile" accept=".zip,.tar.gz">
                        <div class="form-text">Upload a .zip or .tar.gz addon package file</div>
                    </div>
                </div>
                
                <div id="urlOption" class="d-none">
                    <div class="mb-3">
                        <label for="addonUrl" class="form-label">Addon URL</label>
                        <input type="url" class="form-control" id="addonUrl" placeholder="https://example.com/addon.zip">
                        <div class="form-text">Direct link to addon package</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="installSelectedAddon()">Install Addon</button>
            </div>
        </div>
    </div>
</div>

<script>
function showInstallAddonModal() {
    new bootstrap.Modal(document.getElementById('installAddonModal')).show();
}

function installAddon(addonId) {
    const addonNames = {
        'advanced-analytics': 'Advanced Analytics',
        'smart-notifications': 'Smart Notifications',
        'mobile-integration': 'Mobile App Integration'
    };
    
    const addonName = addonNames[addonId] || addonId;
    
    if (confirm(`Are you sure you want to install "${addonName}"? This will download and configure the addon automatically.`)) {
        // Simulate installation process
        const button = event.target;
        const originalText = button.innerHTML;
        
        button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Installing...';
        button.disabled = true;
        
        setTimeout(() => {
            button.innerHTML = '<i class="fas fa-check me-1"></i>Installed';
            button.className = 'btn btn-sm btn-success';
            
            setTimeout(() => {
                alert(`${addonName} has been successfully installed! You may need to restart the server for changes to take effect.`);
                location.reload();
            }, 1000);
        }, 3000);
    }
}

function installSelectedAddon() {
    const source = document.getElementById('addonSource').value;
    let addonInfo = '';
    
    switch(source) {
        case 'marketplace':
            addonInfo = document.getElementById('addonSearch').value || 'selected addon';
            break;
        case 'file':
            const file = document.getElementById('addonFile').files[0];
            addonInfo = file ? file.name : 'no file selected';
            break;
        case 'url':
            addonInfo = document.getElementById('addonUrl').value || 'no URL provided';
            break;
    }
    
    if (addonInfo === 'no file selected' || addonInfo === 'no URL provided' || addonInfo === '') {
        alert('Please select an addon or provide required information.');
        return;
    }
    
    alert(`Installing addon: ${addonInfo}\n\nThis is a demo. In a real implementation, the addon would be downloaded, validated, and installed automatically.`);
    
    // Hide modal
    bootstrap.Modal.getInstance(document.getElementById('installAddonModal')).hide();
}

// Handle installation source change
document.getElementById('addonSource').addEventListener('change', function() {
    const source = this.value;
    
    document.getElementById('marketplaceOption').classList.toggle('d-none', source !== 'marketplace');
    document.getElementById('fileOption').classList.toggle('d-none', source !== 'file');
    document.getElementById('urlOption').classList.toggle('d-none', source !== 'url');
});
</script>

<%- include('../partials/footer') %>